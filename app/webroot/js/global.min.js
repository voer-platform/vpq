$(function(){
	$('#open-notifications').click(function(){
		if($(this).attr('data-unread')>0)
		{
			$.ajax({
				type: 'POST',
				url: '/People/resetNotifyCounter',
				success: function(response){
					$(this).attr('data-unread', 0);
					$('.notify-counter').remove();
				}	
			});
		}
	});
	
	$('.notify-scroll').slimScroll({
        height: 'auto'
    });
	
	$('.table-scroll').slimScroll({
        height: 250
    });
	
	function showDialogMessage(args)
	{
		switch(args[0])
		{
			case 'error': textClass = 'danger'; break;
			case 'success': textClass = 'success'; break;
			default: textClass = 'warning';
		}

		$('#dialog-alert').removeClass().addClass('alert alert-'+textClass).html(args[1]).show();
		
		if(args[2])
		{
			$(document).find('#dialog form')[0].reset();
		}
	}
	
	function buildDialog(data)
	{
		$.get(PLS.ajaxUrl+data.url).success(function(response){
			width = '';
			callback = '';
			submitText = 'Cập nhật';
			cancelText = 'Đóng';
			showSubmit = true;
			
			if(data.showsubmit==false)
			{
				showSubmit = false;
			}
			if(data.textsubmit)
			{
				submitText = data.textsubmit;
			}
			if(data.width)
			{
				width = 'w-'+data.width;
			}
			
			dialogHtml = '<div class="modal" id="dialog"><div class="modal-dialog '+width+'"><div class="modal-content">';
			dialogHtml+= '<div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>';
			dialogHtml+= '<h4 class="modal-title">'+data.title+'</h4></div>';
			dialogHtml+= '<div class="modal-body"><div class="alert" id="dialog-alert" style="display:none;"></div>';
			dialogHtml+= response;
			dialogHtml+= '</div><div class="modal-footer mgt-0">';
			if(showSubmit){
				dialogHtml+= '<button type="button" class="btn btn-primary" id="dialog-submit">'+submitText+'</button>';
			}	
			dialogHtml+= '<button type="button" class="btn btn-default" data-dismiss="modal">'+cancelText+'</button></div></div></div></div>';
			dialog = $(dialogHtml);
			dialog.appendTo('body');
			dialog.modal()
			.on('hidden.bs.modal', function (e) {
				dialog.remove();
			});
			if(data.callback)
			{
				$(document).on('click', '#dialog-submit', data.callback);
			}
		});
	}
	
	$('#change-password').click(function(){
		buildDialog({
			title: 'Thay đổi mật khẩu', 
			url: 'people/changePassword', 
			width: 450, 
			submitText: 'Thay đổi',
			callback: function(){
						if($('#new-password').val()=='' || $('#current-password').val()=='')
						{
							showDialogMessage(['error', 'Vui lòng nhập đủ thông tin']);
						}
						else if($('#new-password').val()!=$('#renew-password').val())
						{
							showDialogMessage(['error', 'Hai mật khẩu phải giống nhau']);
						}
						else
						{
							postData = {
											'cpwd': $('#current-password').val(),
											'npwd': $('#new-password').val(),
											'rnpwd': $('#renew-password').val()
									   };
							$.post(PLS.ajaxUrl+'people/changePassword', postData, function(response){
								postResult = JSON.parse(response);
								if(postResult.code==1)
								{
									showDialogMessage(['success', postResult.mess, true]);
								}
								else
								{
									showDialogMessage(['error', postResult.mess]);
								}
							});
						}
					}
		});
	});
	
	
});

function validateEmail(email) {
    var re = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
    return re.test(email);
}